<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://d3j0t7vrtr92dk.cloudfront.net/brakes4less/1691091298_favicon.png" rel="shortcut icon">
  <title>Schedule Search</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
    }
    .container {
      width: 90%;
      margin: auto;
    }
    header {
      background: #333;
      color: #fff;
      padding: 30px 0;
      text-align: center;
    }
    header h1 {
      margin: 0;
      font-size: 24px;
    }
    form {
      margin: 20px 0;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    select, input[type="date"], input[type="text"] {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 10px;
    }
    #searchButton {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background-color: #218f50;
      color: white;
      cursor: pointer;
      width: 100%;
      box-sizing: border-box;
    }
    #searchButton:hover {
      background-color: #155e35;
    }
    .error-message {
      color: red;
      font-weight: bold;
    }
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      padding: 15px;
    }
    .card-header {
      font-weight: bold;
      margin-bottom: 10px;
    }
    .card-detail {
      margin-bottom: 8px;
    }
    .grey-out {
      background-color: #e0e0e0;
    }
  </style>
</head>
<body>
  <header>
    <h1>Schedule Search</h1>
  </header>
  <div class="container">
    <form id="searchForm">
      <label for="districtManager">District Manager</label>
      <select id="districtManager" name="districtManager">
        <option value="">Select District Manager</option>
        <option value="1">Joe Lehecka</option>
        <option value="2">John Shook</option>
        <option value="3">Tim York</option>
        <option value="4">John Dacey</option>
        <option value="5">Brian Streit</option>
        <option value="6">Johnny Lehecka</option>
      </select>
      <label for="storeNumber">Store Number</label>
      <select id="storeNumber" name="storeNumber">
        <option value="">###</option>
        <option value="1">1</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="104">104</option>
        <option value="105">105</option>
        <option value="107">107</option>
        <option value="108">108</option>
        <option value="109">109</option>
        <option value="110">110</option>
        <option value="201">201</option>
        <option value="202">202</option>
        <option value="203">203</option>
        <option value="204">204</option>
        <option value="205">205</option>
        <option value="206">206</option>
        <option value="207">207</option>
        <option value="208">208</option>
        <option value="301">301</option>
        <option value="302">302</option>
        <option value="305">305</option>
        <option value="307">307</option>
        <option value="308">308</option>
        <option value="309">309</option>
        <option value="311">311</option>
        <option value="312">312</option>
        <option value="313">313</option>
        <option value="314">314</option>
        <option value="316">316</option>
        <option value="317">317</option>
        <option value="318">318</option>
        <option value="319">319</option>
        <option value="321">321</option>
        <option value="Admin">Admin</option>
      </select>
      <label for="employeeName">Employee Name</label>
      <input type="text" id="employeeName" name="employeeName">
      <label for="startDate">Start Date - First Monday of the Pay Period</label>
      <input type="date" id="startDate" name="startDate">
      <button type="submit" id="searchButton">Search</button>
    </form>
    <div id="errorMessage" class="error-message"></div>
    <div id="resultsContainer"></div>
    <div class="pagination">
      <button id="prevButton" onclick="prevPage()" disabled>Previous</button>
      <button id="nextButton" onclick="nextPage()" disabled>Next</button>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const districtManagerStores = {
        '1': ['317', '318'],
        '2': ['307', '309'],
        '3': ['104', '105', '107', '108', '109', '110', '201', '202', '203', '204', '205', '206', '207', '208'],
        '4': ['302', '319', '308'],
        '5': ['301', '305', '311', '312', '313', '314', '316'],
        '6': ['1', '4', '5', '6', '7', '10', '11']
      };

      const rowsPerPage = 10;
      let currentPage = 1;
      let data = [];

      function fetchData(query = '') {
        fetch(`https://script.google.com/macros/s/AKfycbx_m0p7-I0r56j2YL_oa9luMkxoN_NlBLlEpRGv96p9MQsk8XqTAEDkAwKbUCCczG34rg/exec${query}`)
          .then(response => response.json())
          .then(fetchedData => {
            data = fetchedData;
            currentPage = 1;
            displayPage(currentPage);
            updatePagination();
          })
          .catch(error => {
            document.getElementById('errorMessage').textContent = 'Error fetching data: ' + error.message;
          });
      }

      function displayPage(page) {
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        const pageData = data.slice(start, end);

        const resultsContainer = document.getElementById('resultsContainer');
        resultsContainer.innerHTML = '';

        if (pageData.length === 0) {
          document.getElementById('errorMessage').textContent = 'No records found.';
        } else {
          document.getElementById('errorMessage').textContent = '';

          pageData.forEach(row => {
            const card = document.createElement('div');
            card.className = 'card';

            const cardHeader = document.createElement('div');
            cardHeader.className = 'card-header';
            cardHeader.textContent = `Store Number: ${row[0]} | Start Date: ${formatDate(row[1])}`;
            card.appendChild(cardHeader);

            const startDate = new Date(row[1]);

            row.slice(2).forEach((cell, index) => {
              const detail = document.createElement('div');
              detail.className = 'card-detail';
              const dayLabel = getHeaderLabel(index + 2);
              const dateLabel = getDateLabel(startDate, index);
              detail.innerHTML = `<strong>${dayLabel} (${dateLabel}):</strong> ${cell}`;
              if (index === 6 || index === 13) { // Grey out Sundays
                detail.classList.add('grey-out');
              }
              card.appendChild(detail);
            });

            resultsContainer.appendChild(card);
          });
        }
      }

      function formatDate(dateStr) {
        const date = new Date(dateStr);
                return `${('0' + (date.getMonth() + 1)).slice(-2)}/${('0' + date.getDate()).slice(-2)}/${date.getFullYear()}`;
      }

      function getHeaderLabel(index) {
        const headers = [
          "Store Number", "Start Date", "Employee Name",
          "Monday (Week 1)", "Tuesday (Week 1)", "Wednesday (Week 1)",
          "Thursday (Week 1)", "Friday (Week 1)", "Saturday (Week 1)",
          "Sunday (Week 1)", "Monday (Week 2)", "Tuesday (Week 2)",
          "Wednesday (Week 2)", "Thursday (Week 2)", "Friday (Week 2)",
          "Saturday (Week 2)", "Sunday (Week 2)"
        ];
        return headers[index];
      }

      function getDateLabel(startDate, offset) {
        const date = new Date(startDate);
        date.setDate(startDate.getDate() + offset);
        return `${('0' + (date.getMonth() + 1)).slice(-2)}/${('0' + date.getDate()).slice(-2)}`;
      }

      function updatePagination() {
        document.getElementById('prevButton').disabled = currentPage === 1;
        document.getElementById('nextButton').disabled = currentPage * rowsPerPage >= data.length;
      }

      function prevPage() {
        if (currentPage > 1) {
          currentPage--;
          displayPage(currentPage);
          updatePagination();
        }
      }

      function nextPage() {
        if (currentPage * rowsPerPage < data.length) {
          currentPage++;
          displayPage(currentPage);
          updatePagination();
        }
      }

      fetchData();

      document.getElementById('searchForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const storeNumber = document.getElementById('storeNumber').value;
        const employeeName = document.getElementById('employeeName').value;
        const startDate = document.getElementById('startDate').value;
        const districtManager = document.getElementById('districtManager').value;

        const query = new URLSearchParams();

        if (districtManager) {
          const stores = districtManagerStores[districtManager] || [];
          if (stores.length > 0) {
            query.append('storeNumber', stores.join(','));
          }
        }

        if (storeNumber) query.append('storeNumber', storeNumber);
        if (employeeName) query.append('employeeName', employeeName);
        if (startDate) query.append('startDate', startDate);

        fetchData(`?${query.toString()}`);
      });

      // Define the nextPage and prevPage functions so they are available globally
      window.nextPage = nextPage;
      window.prevPage = prevPage;
    });
  </script>
</body>
</html>
